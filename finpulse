upstream myapp_prod {
  server unix:/root/public_html/finpulse.com/finpulse.sock fail_timeout=0;
}


server {
  listen 80 default_server;
  server_name .nishantgaurav.com;
  return 301 https://nishantgaurav.com$request_uri;
}


server {
  listen 443 default_server ssl;
  server_name nishantgaurav.com;
  ssl_certificate /etc/nginx/ssl/server.crt;
  ssl_certificate_key /etc/nginx/ssl/server.key;
  ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers         ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS;


  client_max_body_size 25M;

  access_log /root/public_html/logs/nginx-access.log;
  error_log /root/public_html/logs/nginx-error.log info;

  location /static {
     autoindex on;
     alias /root/public_html/staticfiles;
  }

  location /media {
     autoindex on;
     alias /root/public_html/media;
  }

  location / {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_pass_header Server;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_connect_timeout 6000;
    proxy_read_timeout 6000;
    if (!-f $request_filename) {
      proxy_pass http://myapp_prod;
      break;
    }
  }

  error_page 405 = $uri; #To allow POST on static pages

}

server {
  listen 443;
  server_name www.nishantgaurav.com;
  return 301 https://nishantgaurav.com$request_uri;
}
